price <- price*(1+k*sample(sp500$change, 1))
}
}
}
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim*length(leverages), clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
price <- start
for(j in 1:num_it){
for(k in leverages){
pb$tick()
sim <- rbind(sim, c(price, j, i, k))
price <- price*(1+k*sample(sp500$change, 1))
}
}
}
colnames(sim) <- c("price", "time", "chain", "leverage")
write.csv(sim, "simulated_data.csv", quote = F, row.names = F)
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
theme_bw()
ggplot(sim, aes(x = time, y = price, color = as.factor(leverage))) +
geom_line() +
theme_bw()
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
View(sim)
### Simulation
start <- 100
num_it <- 20
num_sim <- 10
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim*length(leverages), clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
close <- start
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in leverages){
# what is the leveraged change?
pb$tick()
price <- close*(1+k*change)
sim <- rbind(sim, c(price, j, i, k))
}
update the new close
close <- close*(1+change)
}
}
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
close <- start
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in leverages){
# what is the leveraged change?
pb$tick()
price <- close*(1+k*change)
sim <- rbind(sim, c(price, j, i, k))
}
# update the new close
close <- close*(1+change)
}
}
colnames(sim) <- c("price", "time", "chain", "leverage")
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
### Simulation
start <- 100
num_it <- 100
num_sim <- 10
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim*length(leverages), clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
close <- start
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in leverages){
# what is the leveraged change?
pb$tick()
price <- close*(1+k*change)
sim <- rbind(sim, c(price, j, i, k))
}
# update the new close
close <- close*(1+change)
}
}
colnames(sim) <- c("price", "time", "chain", "leverage")
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_smooth() +
facet_wrap(~leverage) +
theme_bw()
### Simulation
start <- 100
num_it <- 100
num_sim <- 20
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim*length(leverages), clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
close <- start
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in leverages){
# what is the leveraged change?
pb$tick()
price <- close*(1+k*change)
sim <- rbind(sim, c(price, j, i, k))
}
# update the new close
close <- close*(1+change)
}
}
colnames(sim) <- c("price", "time", "chain", "leverage")
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = time, y = price, color = as.factor(leverage))) +
geom_line() +
#facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = time, y = price, color = as.factor(leverage))) +
geom_line() +
facet_wrap(~chain) +
theme_bw()
### Simulation
start <- 100
num_it <- 200
num_sim <- 5
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim*length(leverages), clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
close <- start
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in leverages){
# what is the leveraged change?
pb$tick()
price <- close*(1+k*change)
sim <- rbind(sim, c(price, j, i, k))
}
# update the new close
close <- close*(1+change)
}
}
colnames(sim) <- c("price", "time", "chain", "leverage")
ggplot(sim, aes(x = time, y = price, color = as.factor(leverage))) +
geom_line() +
facet_wrap(~chain) +
theme_bw()
### Simulation
start <- 100
num_it <- 200
num_sim <- 5
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim*length(leverages), clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in 1:length(leverages)){
sim <- rbind(sim, c(prices[k], j, i, leverages(k)))
pb$tick()
}
prices <- prices*(1+leverages*change)
}
}
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in 1:length(leverages)){
sim <- rbind(sim, c(prices[k], j, i, leverages[k]))
pb$tick()
}
prices <- prices*(1+leverages*change)
}
}
colnames(sim) <- c("price", "time", "chain", "leverage")
ggplot(sim, aes(x = time, y = price, color = as.factor(leverage))) +
geom_line() +
facet_wrap(~chain) +
theme_bw()
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
### Simulation
start <- 100
num_it <- 200
num_sim <- 10
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim*length(leverages), clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
for(j in 1:num_it){
# choose a daily change
change <- sample(sp500$change, 1)
for(k in 1:length(leverages)){
sim <- rbind(sim, c(prices[k], j, i, leverages[k]))
pb$tick()
}
prices <- prices*(1+leverages*change)
}
}
colnames(sim) <- c("price", "time", "chain", "leverage")
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
### Simulation
start <- 100
num_it <- 200
num_sim <- 10
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim, clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
colnames(sim) <- c("price", "leverage2x", "leverage3x", "time", "chain")
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim, clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
colnames(sim) <- c("price", "leverage2x", "leverage3x", "time", "chain")
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
sim$divergence <- (sim$leverage3x - sim$price) / sim$price
ggplot(sim, aes(x = time, y = divergence, color = as.factor(chain))) +
geom_line() +
theme_bw()
### Simulation
start <- 100
num_it <- 2000
num_sim <- 10
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim, clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
colnames(sim) <- c("price", "leverage2x", "leverage3x", "time", "chain", "change")
ggplot(sim, aes(x = time, y = price, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
?melt
sim <- reshape2::melt.data.frame(sim, measure.vars = c("price", "leverage2x", "leverage3x"))
library(reshape2)
sim <- melt.data.frame(sim, measure.vars = c("price", "leverage2x", "leverage3x"))
sim <- melt(sim, measure.vars = c("price", "leverage2x", "leverage3x"))
### Simulation
start <- 100
num_it <- 2000
num_sim <- 10
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim, clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
colnames(sim) <- c("1", "2", "3", "time", "chain", "change")
sim$divergence <- (sim$`3` - sim$`1`) / sim$`1`
ggplot(sim, aes(x = time, y = divergence, color = as.factor(chain))) +
geom_line() +
theme_bw()
library(reshape2)
sim <- melt(sim, measure.vars = c("1", "2", "3"), variable.name = "leverage")
ggplot(sim, aes(x = time, y = value, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = time, y = value, color = as.factor(chain))) +
geom_smooth() +
facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = time, y = divergence, color = as.factor(chain))) +
geom_line() +
theme_bw()
### Simulation
start <- 100
num_it <- nrow(sp500)
num_sim <- 10
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim, clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
colnames(sim) <- c("1", "2", "3", "day", "chain", "change")
sim$divergence <- (sim$`3` - sim$`1`) / sim$`1`
ggplot(sim, aes(x = day, y = divergence, color = as.factor(chain))) +
geom_line() +
theme_bw()
write.csv(sim, "simulated_data.csv", quote = F, row.names = F)
library(reshape2)
sim <- melt(sim, measure.vars = c("1", "2", "3"), variable.name = "leverage")
ggplot(sim, aes(x = day, y = value, color = as.factor(chain))) +
geom_smooth() +
facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = day, y = value, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw()
ggplot(sim, aes(x = day, y = value, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw() +
scale_y_log10()
### Simulation
start <- 100
num_it <- nrow(sp500)
num_sim <- 100
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim, clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
### Simulation
start <- 100
num_it <- nrow(sp500)
num_sim <- 20
leverages <- c(1, 2, 3)
library(progress)
pb <- progress_bar$new(
format = "  simulating [:bar] :current/:total (:percent) | eta: :eta",
total = num_it*num_sim, clear = FALSE, width= 60)
sim <- as.data.frame(NULL)
for(i in 1:num_sim){
prices <- rep(start, length(leverages))
change <- 0
for(j in 1:num_it){
sim <- rbind(sim, c(prices, j, i, change))
change <- sample(sp500$change, 1)
prices <- prices*(1+leverages*change)
pb$tick()
}
}
colnames(sim) <- c("1", "2", "3", "day", "chain", "change")
sim$divergence <- (sim$`3` - sim$`1`) / sim$`1`
ggplot(sim, aes(x = day, y = divergence, color = as.factor(chain))) +
geom_line() +
theme_bw()
write.csv(sim, "simulated_data.csv", quote = F, row.names = F)
library(reshape2)
sim <- melt(sim, measure.vars = c("1", "2", "3"), variable.name = "leverage")
ggplot(sim, aes(x = day, y = value, color = as.factor(chain))) +
geom_line() +
facet_wrap(~leverage) +
theme_bw() +
scale_y_log10()
ggplot(sim, aes(x = day, y = value, color = as.factor(chain))) +
geom_smooth() +
facet_wrap(~leverage) +
theme_bw() +
scale_y_log10()
ggplot(sp500, aes(x=change)) +
geom_freqpoly() +
theme_bw()
ggplot(sp500, aes(x=intraday_change)) +
geom_freqpoly() +
theme_bw()
ggplot(sp500, aes(x=change)) +
geom_density() +
theme_bw()
ggplot(sp500, aes(x=intraday_change)) +
geom_density() +
theme_bw()
ggplot(sp500, aes(x=change)) +
geom_density() +
theme_bw()
ggplot(sp500, aes(x=intraday_change)) +
geom_density() +
theme_bw()
prev_day[7620]<-NULL
prev_day <- prev_day[1:7619]
summary(lm(sp500$close ~ prev_day))
summary(glm(sp500$close ~ prev_day))
plot(prev_day, sp500$close)
ggplot(sim, aes(x = day, y = divergence, color = as.factor(chain))) +
geom_smooth() +
theme_bw()
